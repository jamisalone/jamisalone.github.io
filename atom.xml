<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-03-19T04:11:26.050Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Sht</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Any Future for Network Engineers?</title>
    <link href="http://example.com/2021/03/19/Any-Future-for-Network-Engineers/"/>
    <id>http://example.com/2021/03/19/Any-Future-for-Network-Engineers/</id>
    <published>2021-03-19T03:38:05.000Z</published>
    <updated>2021-03-19T04:11:26.050Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>听了3月11日的David Bombal和Ivan Pepelnjak的对谈(<a class="link" href="https://www.youtube.com/watch?v=LzooeiGxKis">https://www.youtube.com/watch?v=LzooeiGxKis<i class="fas fa-external-link-alt"></i></a>)</p><p>这个对谈主要针对网络自动化和编程的看法进行讨论（当然David作为思科讲师，不免有些恰饭的言论，不过不影响Ivan的观点阐述），围绕怎么定义网工的成功、网络专家的定义、网络自动化与编程的关系、考证的必要性和对年轻人的建议等问题展开。</p><p><img src="/2021/03/19/Any-Future-for-Network-Engineers/cover.jpg" alt="cover"></p><p>David Bombal：</p><ul><li><p>参与了多个新兴产品和技术的自定进度视频培训的创建，在2003年获得CCIE #11023 Emeritus，从事网络相关内容的培训和开发已经超过15年。【From <a class="link" href="https://www.linkedin.com/in/davidbombal/%E3%80%91">https://www.linkedin.com/in/davidbombal/】<i class="fas fa-external-link-alt"></i></a></p></li><li><p>YouTube: <a class="link" href="http://youtube.com/davidbombal">http://youtube.com/davidbombal<i class="fas fa-external-link-alt"></i></a></p></li><li><p>Website: <a class="link" href="https://davidbombal.com/">https://davidbombal.com<i class="fas fa-external-link-alt"></i></a></p></li></ul><p>Ivan Peplnjak：</p><ul><li>Ivan Pepelnjak，CCIE#1354 Emeritus，在网络行业有30年的经验，在设计、安装、故障诊断和运营大型服务提供商和企业WAN和LAN网络方面有25年以上的经验。他目前是ipSpace.net AG的独立网络架构师，专注于软件定义网络、大型数据中心技术和基于IP/MPLS的高级网络。他在思科出版社出版的著作包括《MPLS和VPN架构》和《EIGRP网络设计》。【From <a class="link" href="https://www.linkedin.com/in/ivanpepelnjak/%E3%80%91">https://www.linkedin.com/in/ivanpepelnjak/】<i class="fas fa-external-link-alt"></i></a></li></ul><h1 id="Content-of-Interview"><a href="#Content-of-Interview" class="headerlink" title="Content of Interview"></a>Content of Interview</h1><p>下面是一些相关问题的记录：</p><ul><li>Should I study networking or rather something else? | 我应该学习网络还是其它的？<ul><li>networking will be always be around 网络会一直存在</li><li>对于networking experts的定义，需要从engineering的定义来说；如果你在mechanical engineering中工作，你有你的组成结构，你可以造桥、造火箭、造车；如果你在networking，你有路由器、交换机，你可以构建网络(build networks)；希望的是，在building networks中有「科学」存在，但实际上我们没有，因为厂商反其道而行；</li><li>当然，我们需要不同级别的专家：使用电力传输作为例子，如果你只是设计一栋大楼中的传输系统，这不是微不足道的(trivial)；但这难度显然不如设计跨国的新电力传输线路；找出设计大楼电力系统的人很少也不易找到，并且很贵；但是每个复杂行业都殊途同归，都会达到有各个级别专家的时候；</li></ul></li><li>I’m starting out - will I be successful? | 从入门到成功？<ul><li>又拿mechanical engineering举例，许多工程师在「做工具」，他们都是highly qualified，但是很多人都只有高中文凭，他们「做工具」很多年了，擅长于他们所作，理所应当的他们受人尊敬，收入可观；</li></ul></li><li>Are certs and degrees valuable?【是否推荐年轻人考证】<ul><li>decent certifications有它存在的理由— 有你不得不学的东西；当然，你可能得到engineering的title但是不一定明白其内容的原理(Ivan打趣说，这是完全不同的故事，证书会让你feel great，但事实上你并没有变得great)</li><li>certification is structured, like learning in university。众所周知，你在大学中学到的知识百分之八十可能在你日后不会在有用。</li><li>force you to learn。考证书，可以迫使你去学习，有一个目标在前面，可以让你学习结构化的知识，这或许是对你的工作有帮助的。</li><li>现在年轻人找工作是一种完全错误的方式，你整理你的简历然后每个人都使用相同的CV润色服务(CV polishing service)，导致每个人都用相同的简历，然后每个人又将这些相同的CV投递到互联网上的公开招募中，Hr就会收到100份相同的简历</li></ul></li><li>Young people are struggling? 【年轻人很挣扎，对自己的未来很迷茫】<ul><li>这个问题时，Ivan抛出一个陈述：certs并不能帮助你证明你是否可以给公司带来价值(add value)</li><li>这里David强行让Ivan抛出例子(捂脸尬笑)<ul><li>Find someone who needs his network fixed and do it for free in the evening；然后把自己的这些经历记录(document)下来，当你面试、写简历时，就把这些经历放上去；你干讲自己有证书，是没有用处的，要把这些经历放上去，这才是你的work，证书不是work，不能表现你的价值；</li><li>找到开源项目团队，开源团队可以从能写文档的人那么获得好处，为开源项目团队写文档；不要指望社会、环境会帮你解决这些问题，你要主动地去寻找解决办法；</li></ul></li><li>「The best jobs are the jobs that are created for you because they want you.」到最后，每个人都是在selling yourself，you have to build your brand。（这个观点蛮有趣地，跟《Show Your Work》书中的“Build a good domain name”章节的观点类似）</li><li>Ivan说他花费了很长时间才在presenting stuff中获利，并且他不认为是时代问题(不是现代社交媒体的因素)，是每个时代只有少数人在表达；社交媒体上，因为0.1%的孩子被看到，但是其实大部分还在在面对镜头时无法表达自己。</li><li>不论是writing还是filming，都关乎的是「你如何打造自己这个品牌」(building your brand)。</li></ul></li><li>Ivan认为在tweeter或者LinkedIn上面发表东西都是短暂的，打造自己的博客是一个long-term的项目，并且你可以去掌握一个你所在行业其他人不太熟悉的东西<ul><li>Don’t use WordPress because people use WordPress is use IT not work for IT; If you work for IT, learning something; Put more details on your site and summary on LinkedIn.</li></ul></li><li>如果你想成为一个网络自动化开发者(对从编程人员来说)，你需要先明白网络是如何工作的；</li><li>What about Cisco DevNet certs?<ul><li>如果你已经是一名网工，然后你认为你不得不成为一个程序员，这是一个坏点子；但我们可以在另一个时间成为一个程序员；如果你已经有networking expertise时，学习DevNet是可以的，因为此时你不知道Python和REST API，还有Git或其他需要学习的东西；</li><li>Ivan认为还是要网络专家与专家级的开发者一起工作，是应对网络自动化转型的最佳选择；我们花费10年成为网络专家，再花费10年成为编程专家，这是费时的；</li></ul></li><li>Recommended Path:<ul><li>Short term(3-5 years): automation or cloud</li><li>Long term(over 10 years): fundamentals; IP routing hasn’t changed in 40 years and Internet hasn’t changed in 40 years, 400G Ethernet is just Ethernet</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Overview&quot;&gt;&lt;a href=&quot;#Overview&quot; class=&quot;headerlink&quot; title=&quot;Overview&quot;&gt;&lt;/a&gt;Overview&lt;/h1&gt;&lt;p&gt;听了3月11日的David Bombal和Ivan Pepelnjak的对谈(&lt;a clas</summary>
      
    
    
    
    <category term="Career" scheme="http://example.com/categories/Career/"/>
    
    
    <category term="职业" scheme="http://example.com/tags/%E8%81%8C%E4%B8%9A/"/>
    
    <category term="网络工程师" scheme="http://example.com/tags/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/"/>
    
    <category term="Future of networking" scheme="http://example.com/tags/Future-of-networking/"/>
    
  </entry>
  
  <entry>
    <title>使用Paramiko配置MSTP场景</title>
    <link href="http://example.com/2021/03/18/Configure-MSTP-with-Paramiko/"/>
    <id>http://example.com/2021/03/18/Configure-MSTP-with-Paramiko/</id>
    <published>2021-03-18T12:13:03.000Z</published>
    <updated>2021-03-18T12:57:43.413Z</updated>
    
    <content type="html"><![CDATA[<h1 id="测试Paramiko配置交换机"><a href="#测试Paramiko配置交换机" class="headerlink" title="测试Paramiko配置交换机"></a>测试Paramiko配置交换机</h1><ul><li><p>拓扑</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled.png" alt="Untitled"></p></li></ul><h2 id="在SW1上配置SSH-Server、SSH登录用户和密码"><a href="#在SW1上配置SSH-Server、SSH登录用户和密码" class="headerlink" title="在SW1上配置SSH Server、SSH登录用户和密码"></a>在SW1上配置SSH Server、SSH登录用户和密码</h2><ul><li><p>创建密钥对</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[SW1]rsa local-key-pair create </span><br><span class="line">The key name will be: SW1_Host</span><br><span class="line">The range of public key size is (512 ~ 2048). </span><br><span class="line">NOTES: If the key modulus is greater than 512, </span><br><span class="line">       it will take a few minutes.</span><br><span class="line">Input the bits <span class="keyword">in</span> the modulus[default = 512]:2048</span><br><span class="line">Generating keys...</span><br><span class="line">..........++++++++++++</span><br><span class="line">..........++++++++++++</span><br><span class="line">.++++++++</span><br><span class="line">....++++++++</span><br></pre></td></tr></table></figure><p>由于ubuntu 20.04是比较新的版本，不再支持1023bit以下长度的密钥，所以直接配置1024或者2048长度的密钥</p></li><li><p>使能Stelnet服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stelnet server <span class="built_in">enable</span></span><br></pre></td></tr></table></figure></li><li><p>配置SSH</p><ul><li><p>配置SSH用户登录界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user-interface vty 0 4</span><br><span class="line"> authentication-mode aaa</span><br><span class="line"> user privilege level 15</span><br><span class="line"> protocol inbound ssh</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>配置SSH用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh user sht</span><br><span class="line">ssh user sht authentication-type password</span><br><span class="line">ssh user sht service-type stelnet</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>如果SSH用户使用password认证( <code>authentication-type = password | rsa | password-rsa</code> )，则只需要在SSH服务器端生成本地RSA密钥。如果SSH用户使用RSA认证，则在服务器端和客户端都需要生成本地RSA密钥对，并且服务器端和客户端都需要将对方的公钥配置到本地。</p></li><li><p>配置对SSH用户进行password认证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br><span class="line"> local-user sht password cipher Huawei</span><br><span class="line"> local-user sht privilege level 15</span><br><span class="line"> local-user sht service-type ssh</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>配置管理VLAN</p><ul><li><p>创建管理VLAN100</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">vlan 100</span><br><span class="line"> management-vlan</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Vlanif100</span><br><span class="line"> ip address 192.168.50.1 255.255.255.0</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>配置Hybrid接口（关于为什么配置Hybrid口，可以参考<a class="link" href="https://juejin.cn/post/6936785033935978526">网络基础回顾[1]<i class="fas fa-external-link-alt"></i></a>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/1</span><br><span class="line"> port hybrid pvid vlan 100</span><br><span class="line"> port hybrid untagged vlan 100</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="Ubuntu-20-04用SSH远程登录SW1，验证SW1的SSH配置是否生效"><a href="#Ubuntu-20-04用SSH远程登录SW1，验证SW1的SSH配置是否生效" class="headerlink" title="Ubuntu 20.04用SSH远程登录SW1，验证SW1的SSH配置是否生效"></a>Ubuntu 20.04用SSH远程登录SW1，验证SW1的SSH配置是否生效</h2><ul><li><p>在ubuntu 20.04上使用<code>ssh sht@192.168.50.1</code>，出现报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh sht@192.168.50.1</span><br><span class="line">**Unable to negotiate with** 192.168.50.1 port 22: **no matching key exchange method found.** </span><br><span class="line">**Their offer: diffie-hellman-group1-sha1,diffie-hellman-group-exchange-sha1**</span><br></pre></td></tr></table></figure><ul><li><p>问题描述：</p><p>如果客户端和服务器无法就一组共同的参数达成一致，那么连接将失败。OpenSSH (7.0及以上版本)会产生类似这样的错误信息，Ubuntu20.04使用OpenSSH 8.2。在这种情况下，客户端和服务器无法就密钥交换算法达成一致，服务器只提供（即该实验中的SW1）两个方法diffie-hellman-group1-sha1和diffie-hellman-group-exchange-sha1，OpenSSH支持这两种密钥交换方法，但是默认不启用，因为这两种方法版本较久，比较弱(weak)，在所谓的Logjam攻击的理论范围内。所以我们需要在客户端启用较弱的方法。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -V</span><br><span class="line">OpenSSH_8.2p1 Ubuntu-4ubuntu0.1, OpenSSL 1.1.1f  31 Mar 2020</span><br></pre></td></tr></table></figure></li><li><p>解决方案：</p><p>来源：</p><p><a class="link" href="http://www.openssh.com/legacy.html">OpenSSH: Legacy Options<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 sht@192.168.50.1</span><br></pre></td></tr></table></figure><ul><li><code>+</code> — 在客户端默认集合中增加该交换算法而不是替换默认算法</li><li><code>-o</code> — 选项</li><li><code>-KexAlgorithms</code> — 密钥交换方法-用来生成每个连接的密钥；</li></ul></li></ul></li><li><p>使用<code>ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 sht@192.168.50.1</code>后，成功连接上SW1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 sht@192.168.50.1</span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.50.1 (192.168.50.1)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is SHA256:BqJmFBxfyFuobgWlC7MmLlpjfu1UjsyhnLbdd/GIVc8.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.50.1<span class="string">&#x27; (RSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">sht@192.168.50.1&#x27;</span>s password: </span><br><span class="line"></span><br><span class="line">Info: The max number of VTY users is 5, and the number</span><br><span class="line">      of current VTY users on line is 1.</span><br><span class="line">      The current login time is 2021-03-02 19:12:58.</span><br><span class="line">&lt;SW1&gt;sys</span><br><span class="line">Enter system view, <span class="built_in">return</span> user view with Ctrl+Z.</span><br><span class="line">[SW1]</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置paramiko-test-py对SW1进行配置"><a href="#配置paramiko-test-py对SW1进行配置" class="headerlink" title="配置paramiko_test.py对SW1进行配置"></a>配置<code>paramiko_test.py</code>对SW1进行配置</h2><ul><li><p>编写脚本paramiko_test.py</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import paramiko</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">ip_address = <span class="string">&quot;192.168.50.1&quot;</span></span><br><span class="line">username = <span class="string">&quot;sht&quot;</span></span><br><span class="line">password = <span class="string">&quot;Huawei&quot;</span></span><br><span class="line"></span><br><span class="line">ssh_client = paramiko.SSHClient()</span><br><span class="line">ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) <span class="comment"># not recommended for production but fine for labs</span></span><br><span class="line">ssh_client.connect(hostname = ip_address, username = username, password = password)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Successful connection&quot;</span>, ip_address)</span><br><span class="line"></span><br><span class="line">remote_connection = ssh_client.invoke_shell()</span><br><span class="line">remote_connection.send(<span class="string">&quot;system\n&quot;</span>)</span><br><span class="line"><span class="comment"># creation of vlans</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range (2,21):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Creating VLAN &quot;</span> + str(n))</span><br><span class="line">    remote_connection.send(<span class="string">&quot;vlan &quot;</span> + str(n) +  <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    remote_connection.send(<span class="string">&quot;description VLAN &quot;</span> + str(n) +  <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    time.sleep(0.5) <span class="comment"># wait half of second</span></span><br><span class="line">remote_connection.send(<span class="string">&quot;return\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">time.sleep(1)</span><br><span class="line">output = remote_connection.recv(65535)</span><br><span class="line"><span class="built_in">print</span>(output.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"></span><br><span class="line">ssh_client.close</span><br></pre></td></tr></table></figure><h2 id="paramiko-test-py脚本解释"><a href="#paramiko-test-py脚本解释" class="headerlink" title="paramiko_test.py脚本解释"></a><code>paramiko_test.py</code>脚本解释</h2><ul><li><p>第一部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip_address = <span class="string">&quot;192.168.50.1&quot;</span></span><br><span class="line">username = <span class="string">&quot;sht&quot;</span></span><br><span class="line">password = <span class="string">&quot;Huawei&quot;</span></span><br><span class="line"></span><br><span class="line">ssh_client = paramiko.SSHClient()</span><br><span class="line">ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) <span class="comment"># not recommended for production but fine for labs</span></span><br><span class="line">ssh_client.connect(hostname = ip_address, username = username, password = password)</span><br></pre></td></tr></table></figure><ul><li><p>Paramiko官方文档给出的<code>paramiko.client.SSHClient</code>类的描述为：</p><p>与SSH服务器建立SSH会话的高级表示，该类封装了<strong>Transport</strong>，<strong>Channel</strong>和<strong>SFTPClient</strong>类来处理好认证和打开通道(channel)。</p><p><code>SSHClient</code>的典型使用方式为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client = SSHClient()</span><br><span class="line">client.load_system_host_keys()</span><br><span class="line">client.connect(<span class="string">&#x27;ssh.example.com&#x27;</span>)</span><br><span class="line"><span class="comment"># stdin, stdout, stderr = client.exec_command(&#x27;ls -l&#x27;) 暂时不用了解</span></span><br></pre></td></tr></table></figure><p>使用<code>SSHClient()</code>创建SSH客户端，上传脚本的一端作为服务端，然后调用<code>load_system_host_keys(filename = None)</code>读取主机密钥，参数<code>filename</code>默认为<code>None</code>，则会尝试从用户的本地 “known hosts”文件中读取密钥；再调用<code>connect()</code>与<code>hostname</code> 为<code>ssh.example.com</code>的服务器建立连接，服务器的主机密钥会与系统主机密钥 (<code>load_system_host_keys</code>) 和任何本地主机密钥 (<code>load_host_keys</code>) 对照检查，如果在这两组主机密钥中都找不到服务器的主机名，则使用缺失主机密钥策略 (<code>set_missing_host_key_policy</code>)，默认策略是决绝连接并报错<code>SSHException</code>；</p></li><li><p><code>set_missing_host_key_policy(paramiko.AutoAddPolicy( ))</code></p><ul><li><code>set_missing_host_key_policy(policy)</code> 设置连接到<strong>未知主机密钥</strong>的服务器时要使用的策略；<code>policy</code>即要设置的策略类，可以设置为RejectPolicy(默认)、AutoAddPolicy和WarningPolicy等；<strong>如果不配置该策略，默认是拒绝与服务器连接的</strong>。</li><li>将<code>paramiko.AutoAddPolicy()</code> 设为参数，用于<strong>自动将主机名和新的主机密钥添加到本地HostKeys对象中</strong>，并将该对信息保存，该方法由SSHClient调用；</li><li>不仅接受了来自未知主机密钥的服务器提供的公钥，建立了连接，还会将主机名与对应的密钥保存到HostKeys对象中，后面再与该服务器进行连接，就可以使用<code>load_system_host_keys</code>或<code>load_host_keys</code>方法了</li></ul></li></ul></li><li><p>第二部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">remote_connection = ssh_client.invoke_shell()</span><br><span class="line">remote_connection.send(<span class="string">&quot;system\n&quot;</span>)</span><br><span class="line"><span class="comment"># creation of vlans</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">2</span>,<span class="number">21</span>):</span><br><span class="line">    print(<span class="string">&quot;Creating VLAN &quot;</span> + <span class="built_in">str</span>(n))</span><br><span class="line">    remote_connection.send(<span class="string">&quot;vlan &quot;</span> + <span class="built_in">str</span>(n) +  <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    remote_connection.send(<span class="string">&quot;description VLAN &quot;</span> + <span class="built_in">str</span>(n) +  <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>) <span class="comment"># wait half of second</span></span><br><span class="line">remote_connection.send(<span class="string">&quot;return\n&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><code>remote_connection = ssh_client.invoke_shell()</code><ul><li>由于SSHClient类封装了Channel类，类似socket，使用<code>invoke_shell()</code>后，客户端会在SSH服务器上启动一个交互式shell会话，即用通道类(<strong>Channel</strong>)新建通道(channel)，并按要求的终端类型和大小连接到一个伪终端</li><li><code>ssh_client</code>是SSHClient类的对象，调用SSHClient的方法<code>invoke_shell()</code>后，创建了<code>remote_connection</code>这个通道类(Channel)的通道</li></ul></li><li><code>remote_connection.send()</code><ul><li>通道(Channel)类中的<code>send()</code>用于传输数据</li><li>这里remote_connection是通道(channel)，调用<code>send()</code>方法向SSH服务器发送数据</li></ul></li></ul></li><li><p>第三部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">output = remote_connection.recv(<span class="number">65535</span>)</span><br><span class="line">print(output.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"></span><br><span class="line">ssh_client.close</span><br></pre></td></tr></table></figure><ul><li><p><code>time.sleep(1)</code></p></li><li><p><code>output = remote_connection.recv(65535)</code> 中，<code>remote_connection</code>通道使用<code>recv(65535)</code>设置读取Bytes的最大值；<code>recv()</code>如果返回字节的长度为0时，通道流就会被关闭；</p></li><li><p><code>output.decode(&#39;ascii&#39;)</code> ，<code>recv()</code>的返回值为字节型字符串，将返回值赋值给<code>output</code>变量，然后在Python 3中使用<code>decode(&#39;ascii&#39;)</code>将字节型字符串解析为ascii编码，帮助输出美观的内容；</p><p>如果不适用<code>decode(&#39;ascii&#39;)</code>，输出如下：</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%201.png" alt="Untitled 1"></p></li><li><p><code>ssh_client.close</code> 关闭<code>ssh_client</code>；<code>close</code>直接关闭SSHClient类</p></li></ul></li></ul></li></ul><h2 id="将配置推送到-pull-to-设备"><a href="#将配置推送到-pull-to-设备" class="headerlink" title="将配置推送到(pull to)设备"></a>将配置推送到(pull to)设备</h2><ul><li><p>上传到SW1【运行代码】</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%202.png" alt="Untitled 2"></p></li><li><p>在SW1上检查脚本配置是否生效</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%203.png" alt="Untitled 3"></p><p>脚本成功远程配置SW1上的vlans。</p></li></ul><h1 id="配置MSTP场景"><a href="#配置MSTP场景" class="headerlink" title="配置MSTP场景"></a>配置MSTP场景</h1><h2 id="拓扑规划与设备基础配置"><a href="#拓扑规划与设备基础配置" class="headerlink" title="拓扑规划与设备基础配置"></a>拓扑规划与设备基础配置</h2><ul><li><p>拓扑与规划</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%204.png" alt="Untitled 4"></p><ul><li>在MST1中，SwitchA作为根，阻塞SwitchD的Ethernet0/0/2接口</li><li>在MST2中，SwitchB作为根，阻塞SwitchC的Ethernet0/0/2接口</li></ul></li><li><p>交换机基础配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">rsa local-key-pair create </span><br><span class="line">**2048**</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">stelnet server <span class="built_in">enable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">user-interface vty 0 4</span><br><span class="line"> authentication-mode aaa</span><br><span class="line"> user privilege level 15</span><br><span class="line"> protocol inbound ssh</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">aaa</span><br><span class="line"> local-user sht password cipher Huawei</span><br><span class="line"> local-user sht privilege level 15</span><br><span class="line"> local-user sht service-type ssh</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ssh user sht</span><br><span class="line">ssh user sht authentication-type password</span><br><span class="line">ssh user sht service-type stelnet</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">vlan 100</span><br><span class="line"> management-vlan</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Vlanif100</span><br><span class="line"> ip address 192.168.50.x 255.255.255.0</span><br></pre></td></tr></table></figure><ul><li><p>SwitchA | SwitchB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>SwitchC | SwitchD</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Ethernet0/0/2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>验证Ubuntu与各交换机的连通性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -f <span class="string">&quot;/home/sht/.ssh/known_hosts&quot;</span> -R <span class="string">&quot;192.168.50.100&quot;</span></span><br><span class="line"><span class="comment"># $ ssh-keygen -f &quot;/home/sht/.ssh/known_hosts&quot; -R &quot;192.168.50.101&quot;</span></span><br><span class="line"><span class="comment"># $ ssh-keygen -f &quot;/home/sht/.ssh/known_hosts&quot; -R &quot;192.168.50.102&quot;</span></span><br><span class="line"><span class="comment"># $ ssh-keygen -f &quot;/home/sht/.ssh/known_hosts&quot; -R &quot;192.168.50.103&quot;</span></span><br></pre></td></tr></table></figure><p>如果都能成功登录，则说明Ubuntu与交换机连通性良好，并且可以进行远程登录；</p></li></ul><h2 id="编写脚本并上传到设备"><a href="#编写脚本并上传到设备" class="headerlink" title="编写脚本并上传到设备"></a>编写脚本并上传到设备</h2><h3 id="脚本总览"><a href="#脚本总览" class="headerlink" title="脚本总览"></a>脚本总览</h3><ul><li><p>配置内容总览</p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%205.png" alt="Untitled 5"></p></li><li><p>脚本总览</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">SwitchA = &#123;</span><br><span class="line">    <span class="string">&#x27;ip&#x27;</span>: <span class="string">&#x27;192.168.50.100&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;sht&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;Huawei&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_root&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;primary_instances&#x27;</span>: [<span class="string">&#x27;1&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;secondary_instances&#x27;</span>: [<span class="string">&#x27;2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;cost_change_interfaces&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;trunk_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/1&#x27;</span>, <span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;access_interfaces&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;root_interfaces&#x27;</span>:[<span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SwitchB = &#123;</span><br><span class="line">    <span class="string">&#x27;ip&#x27;</span>: <span class="string">&#x27;192.168.50.101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;sht&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;Huawei&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_root&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">&#x27;primary_instances&#x27;</span>: [<span class="string">&#x27;2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;secondary_instances&#x27;</span>: [<span class="string">&#x27;1&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;cost_change_interfaces&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;trunk_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/1&#x27;</span>, <span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;access_interfaces&#x27;</span>: [],</span><br><span class="line">     <span class="string">&#x27;root_interfaces&#x27;</span>:[<span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SwitchC = &#123;</span><br><span class="line">    <span class="string">&#x27;ip&#x27;</span>: <span class="string">&#x27;192.168.50.102&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;sht&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;Huawei&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_root&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;primary_instances&#x27;</span>: [<span class="string">&#x27;1&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;secondary_instances&#x27;</span>: [<span class="string">&#x27;2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;cost_change_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;trunk_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/1&#x27;</span>, <span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;access_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;root_interfaces&#x27;</span>:[],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SwitchD = &#123;</span><br><span class="line">    <span class="string">&#x27;ip&#x27;</span>: <span class="string">&#x27;192.168.50.103&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;sht&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;Huawei&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_root&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;primary_instances&#x27;</span>: [<span class="string">&#x27;2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;secondary_instances&#x27;</span>: [<span class="string">&#x27;1&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;cost_change_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;trunk_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/1&#x27;</span>, <span class="string">&#x27;e0/0/2&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;access_interfaces&#x27;</span>: [<span class="string">&#x27;e0/0/3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;root_interfaces&#x27;</span>:[],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">paramiko_SSH_Command</span>(<span class="params">switch</span>):</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; Start &#x27;&#x27;&#x27;</span></span><br><span class="line">ssh_client = paramiko.SSHClient()</span><br><span class="line">ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) <span class="comment"># not recommended for production but fine for labs</span></span><br><span class="line">ssh_client.connect(hostname = switch[<span class="string">&#x27;ip&#x27;</span>], username = switch[<span class="string">&#x27;username&#x27;</span>], password = switch[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;               &quot;</span>*<span class="number">3</span>)</span><br><span class="line">print(<span class="string">&quot;===============&quot;</span>*<span class="number">3</span>)</span><br><span class="line">print(<span class="string">&quot;               &quot;</span>*<span class="number">3</span>)</span><br><span class="line">print(<span class="string">&quot;Successful connection&quot;</span>, switch[<span class="string">&#x27;ip&#x27;</span>])</span><br><span class="line">remote_connection = ssh_client.invoke_shell()</span><br><span class="line"></span><br><span class="line">remote_connection.send(<span class="string">&quot;system\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; Some Configuration Functions &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">common_Configuration(remote_connection, switch[<span class="string">&#x27;cost_change_interfaces&#x27;</span>], switch[<span class="string">&#x27;secondary_instances&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> switch[<span class="string">&#x27;is_root&#x27;</span>]:</span><br><span class="line">root_PriSec(remote_connection, switch[<span class="string">&#x27;primary_instances&#x27;</span>], switch[<span class="string">&#x27;secondary_instances&#x27;</span>])</span><br><span class="line">edged_port_bpdu_protection(remote_connection, switch[<span class="string">&#x27;access_interfaces&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> switch[<span class="string">&#x27;root_interfaces&#x27;</span>]:</span><br><span class="line">root_protection(remote_connection, switch[<span class="string">&#x27;root_interfaces&#x27;</span>])</span><br><span class="line">conf_trunk_interfaces(remote_connection, switch[<span class="string">&#x27;trunk_interfaces&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> switch == SwitchC:</span><br><span class="line">conf_access_interfaces(remote_connection, switch[<span class="string">&#x27;access_interfaces&#x27;</span>], <span class="number">2</span>)</span><br><span class="line"><span class="keyword">elif</span> switch == SwitchD:</span><br><span class="line">conf_access_interfaces(remote_connection, switch[<span class="string">&#x27;access_interfaces&#x27;</span>], <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; End &#x27;&#x27;&#x27;</span></span><br><span class="line">remote_connection.send(<span class="string">&quot;return\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;save\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;y\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">output = remote_connection.recv(<span class="number">65535</span>)</span><br><span class="line">print(output.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"></span><br><span class="line">ssh_client.close</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">common_Configuration</span>(<span class="params">remote_connection, cost_change_interfaces, secondary_instances</span>):</span></span><br><span class="line"><span class="comment"># Stp region_configuration</span></span><br><span class="line">print(<span class="string">&quot;Configuring stp region_configuration ...&quot;</span>)</span><br><span class="line">region_configurations = [<span class="string">&#x27;stp region-configuration\n&#x27;</span>, <span class="string">&#x27;region-name RG1\n&#x27;</span>, <span class="string">&#x27;instance 1 vlan 2 to 10\n&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;instance 2 vlan 11 to 20\n&#x27;</span>, <span class="string">&#x27;active region-configuration\n&#x27;</span>, <span class="string">&#x27;quit\n&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> region_configuration <span class="keyword">in</span> region_configurations:</span><br><span class="line">remote_connection.send(region_configuration)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stp cost computing methods</span></span><br><span class="line">print(<span class="string">&quot;Configuring stp pathcost-standard legacy ...&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp pathcost-standard legacy\n&quot;</span>)</span><br><span class="line"><span class="comment"># Stp interface cost</span></span><br><span class="line">print(<span class="string">&quot;Configuring interface cost ...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cost_change_interfaces:</span><br><span class="line"><span class="keyword">for</span> secondary_instance <span class="keyword">in</span> secondary_instances:</span><br><span class="line"><span class="keyword">for</span> cost_change_interface <span class="keyword">in</span> cost_change_interfaces:</span><br><span class="line">remote_connection.send(<span class="string">&quot;interface &quot;</span> + cost_change_interface + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp instance &quot;</span> + secondary_instance +<span class="string">&quot; cost 20000\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># STP enable</span></span><br><span class="line">print(<span class="string">&quot;Creating VLAN and Enabling STP ...&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;vlan batch 2 to 20\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp enable\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conf_trunk_interfaces</span>(<span class="params">remote_connection, trunk_interfaces</span>):</span></span><br><span class="line">print(<span class="string">&quot;Configuring trunk interfaces ...&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> trunk_interface <span class="keyword">in</span> trunk_interfaces:</span><br><span class="line">remote_connection.send(<span class="string">&quot;interface &quot;</span> + trunk_interface + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;port link-type trunk\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;port trunk allow-pass vlan 2 to 20\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conf_access_interfaces</span>(<span class="params">remote_connection, access_interfaces, access_vlan</span>):</span></span><br><span class="line">print(<span class="string">&quot;Configuring access interfaces ...&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> access_interface <span class="keyword">in</span> access_interfaces:</span><br><span class="line">remote_connection.send(<span class="string">&quot;interface &quot;</span> + access_interface + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;port link-type access\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;port default vlan &quot;</span> + <span class="built_in">str</span>(access_vlan) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">root_protection</span>(<span class="params">remote_connection, interfaces</span>):</span></span><br><span class="line">print(<span class="string">&quot;Configuring stp protection ...&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> interface <span class="keyword">in</span> interfaces:</span><br><span class="line">remote_connection.send(<span class="string">&quot;interface &quot;</span> + interface + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp root-protection\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edged_port_bpdu_protection</span>(<span class="params">remote_connection, interfaces</span>):</span></span><br><span class="line">print(<span class="string">&quot;Configuring edged-port and bpdu protection ...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> interfaces:</span><br><span class="line"><span class="keyword">for</span> interface <span class="keyword">in</span> interfaces:</span><br><span class="line">remote_connection.send(<span class="string">&quot;interface &quot;</span> + interface + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp edged-port enable\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp bpdu-protection\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">root_PriSec</span>(<span class="params">remote_connection, primary_instances, secondary_instances</span>):</span></span><br><span class="line"><span class="comment"># Stp primary root</span></span><br><span class="line">print(<span class="string">&quot;Configuring primary root ...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> primary_instances:</span><br><span class="line"><span class="keyword">for</span> primary_instance <span class="keyword">in</span> primary_instances:</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp instance &quot;</span> + primary_instance + <span class="string">&quot; root primary\n&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">&quot;No primary root configuration.&quot;</span>)</span><br><span class="line"><span class="comment"># Stp secondary root</span></span><br><span class="line">print(<span class="string">&quot;Configuring secondary root ...&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> secondary_instances:</span><br><span class="line"><span class="keyword">for</span> secondary_instance <span class="keyword">in</span> secondary_instances:</span><br><span class="line">remote_connection.send(<span class="string">&quot;stp instance &quot;</span> + secondary_instance + <span class="string">&quot; root secondary\n&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">&quot;No secondary root configuration.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">paramiko_SSH_Command(SwitchA)</span><br><span class="line">paramiko_SSH_Command(SwitchB)</span><br><span class="line">paramiko_SSH_Command(SwitchC)</span><br><span class="line">paramiko_SSH_Command(SwitchD)</span><br></pre></td></tr></table></figure></li></ul><h3 id="将配置推送到设备"><a href="#将配置推送到设备" class="headerlink" title="将配置推送到设备"></a>将配置推送到设备</h3><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%206.png" alt="Untitled 6"></p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%207.png" alt="Untitled 7"></p><h3 id="脚本解析"><a href="#脚本解析" class="headerlink" title="脚本解析"></a>脚本解析</h3><ul><li>使用字典(dict)来规范交换机的配置参数<ul><li>接入层与汇聚层在某些配置上不同，而字典中的键是相同的</li><li>为了后续调用不同方法配置不同配置，没有相应配置的key都设置了空值，函数在被调用时先判断是否为空值；如果为空，则不进行特定功能的配置；如果不为空，则根据键(key)来调用值(value)，进行相应功能的配置；</li></ul></li><li>使用<code>paramiko_SSH_Command(switch)</code>作为一个总方法来调用其余对应各类配置的方法<ul><li>四台交换机的stp region-configuraion配置相同，并且都需要创建相同的VLAN然后使能STP(默认MSTP模式)；除此以外，STP开销都使用华为特有的计算方法；用一个函数<code>common_Configuration</code>封装；</li><li>配置access接口时，汇聚层的SwitchA和SwitchB不需要配置，所以调用<code>conf_access_interfaces(remote_connection, access_interfaces, access_vlan)</code> 时，先判断switch对象是否为SwitchC或SwitchD；根据不同Switch指定的接口PVID也不同，比如SwitchC负责偶数vlan下的主机，而SwitchD负责奇数vlan下的主机，通过匹配SwitchC还是SwitchD，来配置不同的PVID；</li><li>类似于边缘端口的配置<code>edged_port_bpdu_protection</code>，不受一些特殊条件限制 (如不同Switch配置不同PVID)，只是每个交换机上需要配置的接口不同，使能边缘端口命令没有其他参数的参与，就可以先判断需要配置边缘端口的列表是否为空，为空则不进行配置，不为空则for循环调用待配置接口列表，各个接口挨个配置；同理，MSTP根和备用根的配置，也只在SwitchA和SwitchB上进行，通过判断是否为空，就可以避免在SwitchC和SwitchD上配置，然后进一步根据设备字典中的instance相关字段，只在汇聚层设备上调用<code>root_PriSec</code>。</li></ul></li></ul><h2 id="验证配置"><a href="#验证配置" class="headerlink" title="验证配置"></a>验证配置</h2><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%208.png" alt="Untitled 8"></p><p><img src="/2021/03/18/Configure-MSTP-with-Paramiko/Untitled%209.png" alt="Untitled 9"></p><ul><li><p>查看端口状态和端口保护类型</p><ul><li><p>SwitchA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA]display stp brief </span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">...</span><br><span class="line">   1    Ethernet0/0/1               DESI  FORWARDING      NONE</span><br><span class="line">   1    Ethernet0/0/2               DESI  FORWARDING      ROOT</span><br><span class="line">   2    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">   2    Ethernet0/0/2               DESI  FORWARDING      ROOT</span><br></pre></td></tr></table></figure><ul><li>在MSTI1中，SwitchA为根桥，则Ethernet0/0/1和Ethernet0/0/2成为指定端口；</li><li>在MSTI2中，SwitchA的Ethernet0/0/1成为指定端口，Ethernet0/0/2成为根端口；</li></ul></li><li><p>SwitchB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB]display stp brief </span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">...</span><br><span class="line">   1    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">   1    Ethernet0/0/2               DESI  FORWARDING      ROOT</span><br><span class="line">   2    Ethernet0/0/1               DESI  FORWARDING      NONE</span><br><span class="line">   2    Ethernet0/0/2               DESI  FORWARDING      ROOT</span><br></pre></td></tr></table></figure><ul><li>在MSTI2中，SwitchB为根桥，则Ethernet0/0/1和Ethernet0/0/2成为指定端口；</li><li>在MSTI1中，SwitchB的Ethernet0/0/2成为指定端口，Ethernet0/0/1成为根端口；</li></ul></li><li><p>SwitchC</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchC&gt;display stp interface Ethernet 0/0/1 brief </span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">..</span><br><span class="line">   1    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">   2    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">&lt;SwitchC&gt;display stp interface Ethernet 0/0/2 brief</span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">...</span><br><span class="line">   1    Ethernet0/0/2               DESI  FORWARDING      NONE</span><br><span class="line">   2    Ethernet0/0/2               ALTE  DISCARDING      NONE</span><br></pre></td></tr></table></figure><ul><li>在MSTI1和MSTI2中，Ethernet0/0/1都是根端口；</li><li>在MST1中，Ethernet0/0/2为指定端口；在MST2中，Ethernet0/0/1被阻塞；</li></ul></li><li><p>SwitchD</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchD&gt;display stp interface e0/0/1 brief </span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">...</span><br><span class="line">   1    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">   2    Ethernet0/0/1               ROOT  FORWARDING      NONE</span><br><span class="line">&lt;SwitchD&gt;display stp interface e0/0/2 brief</span><br><span class="line"> MSTID  Port                        Role  STP State     Protection</span><br><span class="line">...</span><br><span class="line">   1    Ethernet0/0/2               ALTE  DISCARDING      NONE</span><br><span class="line">   2    Ethernet0/0/2               DESI  FORWARDING      NONE</span><br></pre></td></tr></table></figure><ul><li>在MSTI1和MSTI2中，Ethernet0/0/1都是根端口；</li><li>在MST2中，Ethernet0/0/2为指定端口；在MST1中，Ethernet0/0/1被阻塞；</li></ul></li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a class="link" href="http://docs.paramiko.org/en/stable/index.html#core-ssh-protocol-classes">Paramiko documentation<i class="fas fa-external-link-alt"></i></a></li><li>华为S3700配置文档</li></ul><h1 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h1><ul><li>本文主要在记录自己学习paramiko的过程，旨在提高自己对paramiko的认识和编程能力，规范性不一定强，只是一种探索方式，可能并不能作为一种可靠的学习参考；</li><li>文中有很多内容是转译和自己的所思所想，可能存在多处错误，也拜托大家能够指出错误和不足之处。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;测试Paramiko配置交换机&quot;&gt;&lt;a href=&quot;#测试Paramiko配置交换机&quot; class=&quot;headerlink&quot; title=&quot;测试Paramiko配置交换机&quot;&gt;&lt;/a&gt;测试Paramiko配置交换机&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;拓扑&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="Network Automation" scheme="http://example.com/categories/Network-Automation/"/>
    
    <category term="eNSP Series" scheme="http://example.com/categories/Network-Automation/eNSP-Series/"/>
    
    
    <category term="Python" scheme="http://example.com/tags/Python/"/>
    
    <category term="eNSP" scheme="http://example.com/tags/eNSP/"/>
    
    <category term="Network Automation网络自动化" scheme="http://example.com/tags/Network-Automation%E7%BD%91%E7%BB%9C%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
    <category term="SSH" scheme="http://example.com/tags/SSH/"/>
    
    <category term="Paramiko" scheme="http://example.com/tags/Paramiko/"/>
    
  </entry>
  
  <entry>
    <title>使用华为模拟器eNSP搭建网络自动化场景</title>
    <link href="http://example.com/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/"/>
    <id>http://example.com/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/</id>
    <published>2021-03-18T12:00:12.000Z</published>
    <updated>2021-03-18T12:57:42.155Z</updated>
    
    <content type="html"><![CDATA[<h1 id="eNSP安装"><a href="#eNSP安装" class="headerlink" title="eNSP安装"></a>eNSP安装</h1><p>eNSP的安装过程省略，才接触eNSP时，安装会遇到需要问题，这里给出我目前能够正常使用的相关软件版本：</p><ul><li>eNSP 1.3.00.100 V100R003C00 SPC100 （目前eNSP官网已经不再进行更新）</li><li>VirtualBox Version 5.2.40 r137108</li><li>Npcap 1.10</li><li>WinPcap 4.1.3</li></ul><p>eNSP第一次新建拓扑前，记得先注册设备：</p><ul><li><p>右上角找到“菜单‘，然后选中”工具“，单击”注册设备“</p></li><li><p>勾选所有设备，然后点击”注册“</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled.png" alt="Untitled"></p></li></ul><h1 id="使用VirtualBox安装自动化Ubuntu-18-04-20-04"><a href="#使用VirtualBox安装自动化Ubuntu-18-04-20-04" class="headerlink" title="使用VirtualBox安装自动化Ubuntu 18.04 | 20.04"></a>使用VirtualBox安装自动化Ubuntu 18.04 | 20.04</h1><ul><li><p>打开VirtualBox，在右上角单击”New“</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled%201.png" alt="Untitled 1"></p></li><li><p>分配内存大小 — 根据电脑配置，为虚拟机分配内存，1G或2G都行（当然笔者宿主机内存较大，选择了4G），然后Next继续</p></li><li><p>选择VM，选中”Create a virtual hard disk now“，单击”Create“</p></li><li><p>后面的几步都选择默认勾选 — ”VDI“ + ”Dynamic allocated“</p></li><li><p>分配存储大小，建议配置15G左右，分配太小可能会无法安装，单击”Create“后退回到主界面</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled%202.png" alt="Untitled 2"></p></li><li><p>这时选中你刚创建的ubuntu主机，然后单击上方菜单的”Start“运行</p></li><li><p>此时弹出运行界面，你需要选择你要安装的镜像的路径</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled%203.png" alt="Untitled 3"></p></li><li><p>后续就会进入ubuntu的安装步骤（此处省略ubuntu后续安装步骤）</p></li></ul><h1 id="配置Ubuntu远程客户端"><a href="#配置Ubuntu远程客户端" class="headerlink" title="配置Ubuntu远程客户端"></a>配置Ubuntu远程客户端</h1><p>这里以ubuntu 18.04为例</p><ul><li><p>重新设置ubuntu 18.04的国内镜像源并刷新列表进行更新</p><p><a class="link" href="https://zhuanlan.zhihu.com/p/61228593">【Ubuntu】Ubuntu 18.04 LTS 更换国内源–解决终端下载速度慢的问题<i class="fas fa-external-link-alt"></i></a></p></li><li><p>安装Python和相关依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python -y</span><br><span class="line">apt-get install build-essential libssl-dev libffi-dev -y</span><br><span class="line">apt-get install python-pip -y</span><br><span class="line">apt-get install python3-pip -y</span><br></pre></td></tr></table></figure></li><li><p>安装paramiko和netmiko</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install cryptography</span><br><span class="line">pip install paramiko</span><br><span class="line">pip install netmiko</span><br><span class="line">pip3 install paramiko</span><br><span class="line">pip3 install netmiko</span><br></pre></td></tr></table></figure></li></ul><h1 id="使用Telnet来配置S3700"><a href="#使用Telnet来配置S3700" class="headerlink" title="使用Telnet来配置S3700"></a>使用Telnet来配置S3700</h1><ul><li><p>设置Cloud</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled%204.png" alt="Untitled 4"></p><p>端口增加完成后，在端口映射入端口和出端口选择不同端口（顺序不影响），然后勾选双向通道，单击”增加“，此时端口映射表会增加一对端口。</p></li><li><p>Cloud设置完毕后，Cloud可以与SW1进行连接了，下图为测试拓扑</p><p><img src="/2021/03/18/Set-up-Network-Automation-Using-Huawei-Emulator-eNSP/Untitled%205.png" alt="Untitled 5"></p></li><li><p>在SW1上配置telnet用户与密码（默认开启telnet）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">aaa</span><br><span class="line"> local-user sht1 password cipher Huawei</span><br><span class="line"> local-user sht1 privilege level 15</span><br><span class="line"> local-user sht1 service-type telnet</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">interface Vlanif1</span><br><span class="line"> ip address 192.168.50.1 255.255.255.0</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">user-interface vty 0 4</span><br><span class="line"> authentication-mode aaa</span><br><span class="line"> user privilege level 15</span><br><span class="line"> protocol inbound all</span><br></pre></td></tr></table></figure></li><li><p>在Ubuntu 18.04上配置telent01.py脚本用于批量创建vlan</p><ul><li><p>Python 3.6 脚本测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line">import getpass</span><br><span class="line">import telnetlib</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;192.168.50.1&quot;</span></span><br><span class="line">user = <span class="string">&quot;sht1&quot;</span></span><br><span class="line">password = getpass.getpass()</span><br><span class="line"></span><br><span class="line">tn = telnetlib.Telnet(HOST)</span><br><span class="line"></span><br><span class="line">tn.read_until(b<span class="string">&quot;Username:&quot;</span>)</span><br><span class="line">tn.write(user.encode(<span class="string">&#x27;ascii&#x27;</span>) + b<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> password:</span><br><span class="line">    tn.read_until(b<span class="string">&quot;Password:&quot;</span>)</span><br><span class="line">    tn.write(password.encode(<span class="string">&#x27;ascii&#x27;</span>) + b<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">tn.write(b<span class="string">&quot;system\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;vlan 2\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;vlan 3\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;vlan 4\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;vlan 5\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;return\n&quot;</span>)</span><br><span class="line">tn.write(b<span class="string">&quot;quit\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tn.read_all().decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure></li><li><p>Python 2.7 脚本测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python2</span></span><br><span class="line">import getpass</span><br><span class="line">import time</span><br><span class="line">import telnetlib</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;192.168.50.1&quot;</span></span><br><span class="line">user = <span class="string">&quot;sht1&quot;</span></span><br><span class="line">password = getpass.getpass()</span><br><span class="line"></span><br><span class="line">tn = telnetlib.Telnet(HOST)</span><br><span class="line"></span><br><span class="line">tn.read_until(<span class="string">&quot;Username:&quot;</span>)</span><br><span class="line">tn.write(user + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> password:</span><br><span class="line">    tn.read_until(<span class="string">&quot;Password:&quot;</span>)</span><br><span class="line">    tn.write(password + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">tn.write(<span class="string">&quot;system\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;vlan 6\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;vlan 7\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;vlan 8\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;vlan 9\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;vlan 10\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;return\n&quot;</span>)</span><br><span class="line">tn.write(<span class="string">&quot;q\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> tn.read_all()</span><br></pre></td></tr></table></figure></li></ul></li><li><p>验证脚本配置是否在SW1上生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[SW1]display vlan </span><br><span class="line">The total number of vlans is : 10</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">U: Up;         D: Down;         TG: Tagged;         UT: Untagged;</span><br><span class="line">MP: Vlan-mapping;               ST: Vlan-stacking;</span><br><span class="line"><span class="comment">#: ProtocolTransparent-vlan;    *: Management-vlan;</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">VID  Type    Ports                                                          </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">1    common  UT:Eth0/0/1(U)     Eth0/0/2(D)     Eth0/0/3(D)     Eth0/0/4(D)     </span><br><span class="line">                Eth0/0/5(D)     Eth0/0/6(D)     Eth0/0/7(D)     Eth0/0/8(D)     </span><br><span class="line">                Eth0/0/9(D)     Eth0/0/10(D)    Eth0/0/11(D)    Eth0/0/12(D)    </span><br><span class="line">                Eth0/0/13(D)    Eth0/0/14(D)    Eth0/0/15(D)    Eth0/0/16(D)    </span><br><span class="line">                Eth0/0/17(D)    Eth0/0/18(D)    Eth0/0/19(D)    Eth0/0/20(D)    </span><br><span class="line">                Eth0/0/21(D)    Eth0/0/22(D)    GE0/0/1(D)      GE0/0/2(D)      </span><br><span class="line"></span><br><span class="line">2    common  </span><br><span class="line">3    common  </span><br><span class="line">4    common  </span><br><span class="line">5    common  </span><br><span class="line">6    common  </span><br><span class="line">7    common  </span><br><span class="line">8    common  </span><br><span class="line">9    common  </span><br><span class="line">10   common  </span><br><span class="line"></span><br><span class="line">VID  Status  Property      MAC-LRN Statistics Description      </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">1    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0001                         </span><br><span class="line">2    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0002                         </span><br><span class="line">3    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0003                         </span><br><span class="line">4    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0004                         </span><br><span class="line">5    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0005                         </span><br><span class="line">6    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0006                         </span><br><span class="line">7    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0007                         </span><br><span class="line">8    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0008                         </span><br><span class="line">9    <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0009                         </span><br><span class="line">10   <span class="built_in">enable</span>  default       <span class="built_in">enable</span>  <span class="built_in">disable</span>    VLAN 0010</span><br></pre></td></tr></table></figure></li><li><p>虽然配置是完成了，但是在运行脚本的过程中也遇到了问题，目前该问题还没有解决，希望有大佬出面解决</p><p>下面是报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;./telnet01.py&quot;</span>, line 29, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(tn.read_all().decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3.6/telnetlib.py&quot;</span>, line 333, <span class="keyword">in</span> read_all</span><br><span class="line">    self.fill_rawq()</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3.6/telnetlib.py&quot;</span>, line 524, <span class="keyword">in</span> fill_rawq</span><br><span class="line">    buf = self.sock.recv(65535)</span><br><span class="line">ConnectionResetError: [Errno 104] Connection reset by peer</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;./telnet02.py&quot;</span>, line 34, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span> tn.read_all()</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/telnetlib.py&quot;</span>, line 385, <span class="keyword">in</span> read_all</span><br><span class="line">    self.fill_rawq()</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/telnetlib.py&quot;</span>, line 576, <span class="keyword">in</span> fill_rawq</span><br><span class="line">    buf = self.sock.recv(65535)</span><br><span class="line">socket.error: [Errno 104] Connection reset by peer</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;eNSP安装&quot;&gt;&lt;a href=&quot;#eNSP安装&quot; class=&quot;headerlink&quot; title=&quot;eNSP安装&quot;&gt;&lt;/a&gt;eNSP安装&lt;/h1&gt;&lt;p&gt;eNSP的安装过程省略，才接触eNSP时，安装会遇到需要问题，这里给出我目前能够正常使用的相关软件版本：&lt;/</summary>
      
    
    
    
    <category term="Network Automation" scheme="http://example.com/categories/Network-Automation/"/>
    
    <category term="eNSP Series" scheme="http://example.com/categories/Network-Automation/eNSP-Series/"/>
    
    
    <category term="Python" scheme="http://example.com/tags/Python/"/>
    
    <category term="Telnet" scheme="http://example.com/tags/Telnet/"/>
    
    <category term="eNSP" scheme="http://example.com/tags/eNSP/"/>
    
    <category term="Network Automation网络自动化" scheme="http://example.com/tags/Network-Automation%E7%BD%91%E7%BB%9C%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
  </entry>
  
</feed>
